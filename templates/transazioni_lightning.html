<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>‚ö° Transazioni Lightning</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <h1>‚ö° Transazioni Lightning ‚ö°</h1>
      <nav>
        {% if current_user.is_authenticated %}
        <span>Ciao, {{ current_user.username }}</span>
        <a href="{{ url_for('auth.logout') }}">Logout</a>
        {% else %}
        <a href="{{ url_for('auth.login') }}">Login</a>
        <a href="{{ url_for('auth.register') }}">Register</a>
        {% endif %}
      </nav>
    </header>
    <!-- üîπ Saldo SATOSHI -->
    <p class="saldo-totale">
      üí∞ Saldo Lightning: {{
      "{:,}".format(saldo_totale_satoshi|int).replace(",", ".") }} SATS
    </p>
    <!-- üîπ Controvalore totale in EUR (opzionale) -->
    {% if transazioni_lightning %} {% set totale_eur = transazioni_lightning |
    map(attribute=7) | sum %}
    <p class="saldo-totale">
      üí∂ Controvalore Totale: {{ "%.2f"|format(totale_eur) }} ‚Ç¨
    </p>
    {% endif %}

    <div class="csv-buttons">
      <a href="{{ url_for('scarica_csv_lightning') }}">
        <button type="button" class="csv-button">üì• Esporta CSV</button>
      </a>
      <a href="{{ url_for('scarica_csv_per_mese_lightning') }}">
        <button type="button" class="csv-button">üì•Esporta CSV per mese</button>
      </a>
    </div>
    <p>
      <a href="{{ url_for('nuova_transazione_lightning') }}"
        >‚ûï Aggiungi una nuova transazione Lightning</a
      >
    </p>
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <ul>
      {% for category, message in messages %} {% if 'lightning' in category %}
      <li class="{{ category }}">{{ message }}</li>
      {% endif %} {% endfor %}
    </ul>
    {% endif %} {% endwith %}

    <table border="1">
      <tr>
        <th>ID</th>
        <th>Data</th>
        <th>Wallet</th>
        <th>Descrizione</th>
        <th>Categoria</th>
        <th>Sottocategoria</th>
        <th>Satoshi</th>
        <th>Controvalore ‚Ç¨</th>
        <th>Valore BTC/‚Ç¨</th>
      </tr>
      {% for t in transazioni_lightning %}
      <tr>
        <td>{{ t[0] }}</td>
        <td>{{ t[1] }}</td>
        <td>{{ t[2] }}</td>
        <td>{{ t[3] }}</td>
        <td>{{ t[4] }}</td>
        <td>{{ t[5] }}</td>
        <td
          class="{% if t[6]|float >= 0 %}importo-positivo{% else %}importo-negativo{% endif %}"
        >
          {{ "{:,}".format(t[6]).replace(",", ".") }}
        </td>

        <td>{{ "%.2f"|format(t[7]) }}</td>
        <td>{{ "%.2f"|format(t[8]) }}</td>
        <td>
          <form
            method="post"
            action="{{ url_for('elimina_transazione_web_lightning', id_transazione=t[0]) }}"
            style="display: inline"
          >
            <button
              type="submit"
              onclick="return confirm('Sei sicuro di voler eliminare questa transazione Lightning?');"
            >
              üóëÔ∏è Elimina
            </button>
          </form>
          <a
            href="{{ url_for('modifica_transazione_web_lightning', id_transazione=t[0]) }}"
            >‚úèÔ∏è Modifica</a
          >
        </td>
      </tr>
      {% endfor %}
    </table>

    <p><a href="/">‚¨ÖÔ∏è Torna alla home</a></p>
  </body>
</html>
